<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pattern Generator</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111827;
      color: #e5e7eb;
      margin: 0;
      padding: 16px;
    }
    .section {
      margin-bottom: 24px;
      background: #1f2937;
      padding: 16px;
      border-radius: 8px;
    }
    label {
      display: block;
      margin-top: 12px;
      font-size: 14px;
    }
    input, select {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      border-radius: 6px;
      border: 1px solid #374151;
      background: #111827;
      color: #f3f4f6;
    }
    button {
      width: 100%;
      margin-top: 16px;
      padding: 10px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    canvas {
      display: block;
      margin: 16px auto 0;
      background: #374151;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <!-- ðŸ”‰ Noise Generator -->
  <div class="section">
    <h2>Noise Generator</h2>

    <label for="noiseType">Noise Type</label>
    <select id="noiseType">
      <option value="white">White Noise</option>
      <option value="perlin">Perlin Noise</option>
      <option value="simplex">Simplex Noise</option>
      <option value="worley">Worley Noise</option>
    </select>

    <label for="noiseScale">Scale</label>
    <input type="range" id="noiseScale" min="10" max="200" value="80" />

    <label for="noiseColor1">Color 1</label>
    <input type="color" id="noiseColor1" value="#000000" />

    <label for="noiseColor2">Color 2</label>
    <input type="color" id="noiseColor2" value="#ffffff" />

    <button id="generateNoise">Generate Noise</button>
  </div>

  <!-- ðŸ”· Geometric Generator -->
  <div class="section">
    <h2>Geometric Pattern</h2>

    <label for="shapeType">Shape</label>
    <select id="shapeType">
      <option value="square">Square Grid</option>
      <option value="hex">Hexagon Grid</option>
      <option value="triangle">Triangle Grid</option>
    </select>

    <label for="cellSize">Cell Size</label>
    <input type="number" id="cellSize" min="5" max="100" value="20" />

    <label for="lineThickness">Line Thickness</label>
    <input type="number" id="lineThickness" min="0.5" max="5" step="0.1" value="1" />

    <label for="lineColor">Line Color</label>
    <input type="color" id="lineColor" value="#60a5fa" />

    <label for="fillColor">Fill Color</label>
    <input type="color" id="fillColor" value="#1f2937" />

    <button id="generateShape">Generate Grid</button>
  </div>

  <!-- ðŸ–¼ Preview + Apply -->
  <div class="section">
    <h2>Preview</h2>
    <canvas id="previewCanvas" width="200" height="200"></canvas>
    <button id="applyPattern">Apply to Selection</button>
  </div>

  <script>
    const canvas = document.getElementById("previewCanvas");
    const ctx = canvas.getContext("2d");

    // Controls
    const noiseType = document.getElementById("noiseType");
    const noiseScale = document.getElementById("noiseScale");
    const noiseColor1 = document.getElementById("noiseColor1");
    const noiseColor2 = document.getElementById("noiseColor2");

    const shapeType = document.getElementById("shapeType");
    const cellSize = document.getElementById("cellSize");
    const lineThickness = document.getElementById("lineThickness");
    const lineColor = document.getElementById("lineColor");
    const fillColor = document.getElementById("fillColor");

    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;
    const randomPoints = Array.from({ length: 40 }, () => ({ x: Math.random(), y: Math.random() }));

    // ðŸŽ¨ Color helper
    function hexToRgb(hex) {
      const num = parseInt(hex.slice(1), 16);
      return { r: (num >> 16) & 255, g: (num >> 8) & 255, b: num & 255 };
    }

    // ðŸ§ª Noise Generators (same as before)
    // ... [Insert perlin2, simplex2, worley2, grad, fade, etc. from previous message here] ...

    // ðŸ”‰ Generate Noise
    document.getElementById("generateNoise").onclick = () => {
      const scale = parseInt(noiseScale.value);
      const color1 = hexToRgb(noiseColor1.value);
      const color2 = hexToRgb(noiseColor2.value);
      const type = noiseType.value;
      const imageData = ctx.createImageData(WIDTH, HEIGHT);

      for (let y = 0; y < HEIGHT; y++) {
        for (let x = 0; x < WIDTH; x++) {
          const i = (y * WIDTH + x) * 4;
          const nx = x / scale;
          const ny = y / scale;
          let t = 0;

          if (type === "white") t = Math.random();
          else if (type === "perlin") t = perlin2(nx, ny) * 0.5 + 0.5;
          else if (type === "simplex") t = simplex2(nx, ny) * 0.5 + 0.5;
          else if (type === "worley") t = worley2(nx, ny);

          imageData.data[i]     = color1.r + t * (color2.r - color1.r);
          imageData.data[i + 1] = color1.g + t * (color2.g - color1.g);
          imageData.data[i + 2] = color1.b + t * (color2.b - color1.b);
          imageData.data[i + 3] = 255;
        }
      }

      ctx.putImageData(imageData, 0, 0);
    };

    // ðŸ§± Generate Shape Pattern
    document.getElementById("generateShape").onclick = () => {
      const shape = shapeType.value;
      const size = parseInt(cellSize.value);
      const stroke = lineColor.value;
      const fill = fillColor.value;
      const thick = parseFloat(lineThickness.value);

      ctx.clearRect(0, 0, WIDTH, HEIGHT);
      ctx.lineWidth = thick;
      ctx.strokeStyle = stroke;
      ctx.fillStyle = fill;

      if (shape === "square") {
        for (let y = 0; y < HEIGHT; y += size) {
          for (let x = 0; x < WIDTH; x += size) {
            ctx.beginPath();
            ctx.rect(x, y, size, size);
            ctx.fill();
            ctx.stroke();
          }
        }
      }

      if (shape === "hex") {
        const h = size * Math.sqrt(3) / 2;
        for (let y = 0; y < HEIGHT + size; y += h) {
          for (let x = 0; x < WIDTH + size; x += size * 1.5) {
            drawHexagon(x, y + (x / size % 2 === 0 ? 0 : h / 2), size);
          }
        }
      }

      if (shape === "triangle") {
        const h = size * Math.sqrt(3) / 2;
        for (let y = 0; y < HEIGHT + size; y += h) {
          for (let x = 0; x < WIDTH + size; x += size) {
            const up = (x / size + y / h) % 2 === 0;
            drawTriangle(x, y, size, up);
          }
        }
      }
    };

    function drawHexagon(cx, cy, r) {
      ctx.beginPath();
      for (let i = 0; i < 6; i++) {
        const angle = Math.PI / 3 * i;
        const x = cx + r * Math.cos(angle);
        const y = cy + r * Math.sin(angle);
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }

    function drawTriangle(x, y, size, up = true) {
      const h = size * Math.sqrt(3) / 2;
      ctx.beginPath();
      if (up) {
        ctx.moveTo(x, y + h);
        ctx.lineTo(x + size / 2, y);
        ctx.lineTo(x + size, y + h);
      } else {
        ctx.moveTo(x, y);
        ctx.lineTo(x + size / 2, y + h);
        ctx.lineTo(x + size, y);
      }
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }

    // ðŸ–¼ Apply to Selection
    document.getElementById("applyPattern").onclick = () => {
      const dataURL = canvas.toDataURL("image/png");
      parent.postMessage({
        pluginMessage: {
          type: "apply-pattern",
          base64: dataURL.split(",")[1]
        }
      }, "*");
    };
  </script>
</body>
</html>